---
role:
  pkg:
    - name: ruby
      action: install
      os: ["!darwin"]
    - name: ruby # rbenv/rvm, ruby-build
      action: install
      os: ["darwin"]
      args: --with-openssl-dir="$(brew --prefix openssl)"

    # - name: build-essential
    #   os: ["debian"]
    # - name: ruby-rdoc # ri...
    #   os: ["alpine"]
    # - name: ruby-dev # $(ruby -e 'puts RUBY_VERSION[/\\d+\\.\\d+/]')-dev
    #   # rubygems, libgemplugin-ruby
    #   os: ["alpine", "debian"]

    # - name: rubygems
    #   os: ["cygwin"]
    # https://bundler.io/
    # Manage gems with pacman on arch: ruby-<gem>
    # https://wiki.archlinux.org/index.php/Ruby#Managing_RubyGems_using_pacman
    # https://github.com/anatol/quarry
    # - name: ruby-bundler # rubygems
    #   os: ["arch"]
  link:
    - .gemrc
  post_install: # $HOME/.gem/....
    # Install header files for ruby
    - command: "sudo apk add -q ruby`ruby -e 'puts RUBY_VERSION[/\\d+\\.\\d+/]'`-dev"
      os: ["alpine"]
    - command: "sudo apt-get install -qqy ruby`ruby -e 'puts RUBY_VERSION[/\\d+\\.\\d+/]'`-dev"
      os: ["debian"]
    # - GEM_HOME=$(ruby -e 'print Gem.user_dir')
    # - PATH="$PATH:$GEM_HOME/bin"
    - ruby --version
    - gem --version
    - gem env gemdir
    - gem env gempath
    - gem env
    # - TODO darwin: PATH="/usr/local/Cellar/ruby/2.5.1/bin:$PATH"
    # - gem update --bindir /usr/local/bin --system
    # - gem update --bindir /usr/local/bin
    # - command: gem install --bindir /usr/local/bin --quiet bundler
    #   os: ["!arch"]
